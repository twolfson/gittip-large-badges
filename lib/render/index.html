<!DOCTYPE html>
<html>
  <head>
    <title>Badge</title>
    <script src="vendor/canvasquery.js"></script>
    <style>
      body {
        margin: 0;
        padding: 0;
      }
      canvas {
        margin-top: 2px;
      }
    </style>
  </head>
  <body>
    <script>
      // Find the username from the search
      var username = window.location.search.slice(1);

      // Synchronously load the widget
      document.write('<script data-gittip-username="' + username + '" src="https://www.gittip.com/assets/widgets/0002.js" ></scr' + 'ipt>');
    </script>

    <div>
      <canvas id="canvas"></canvas>
      <script>
        // Find the canvas and define the height
        var canvas = document.getElementById('canvas'),
            width = 116,
            height = 71;
        canvas.width = width;
        canvas.height = height;

        // Get the context
        var context = canvas.getContext('2d');

        // Start the rounded rectangle
        context.lineWidth = 2;
        context.font = 'normal 9pt/12pt Lato, sans-serif';

        // // Upper-left curve of rounded rectangle
        // context.arc(6 + 1, 6 + 1, 6, Math.PI, 3 * Math.PI / 2);
        // context.stroke();

        // // Top edge of rounded rectangle
        // context.moveTo(6, 1);
        // context.lineTo(width - 6 - 1, 1);
        // context.stroke();

        var ctx = cq(canvas);
        ctx
          .roundRect(1, 1, width - 2, height - 2, 8)
          .stroke()
          // 9pt left, 6pt top + 12pt line height
          .fillStyle('#614C3E')
          .fillText('I receive', 9 * 4/3, (6 + 12) * 4/3)
          .fillText('$0.00', 9 * 4/3, (6 + (2 * 12)) * 4/3);

        ctx
          .fillText(' / wk', (9 * 4/3) + ctx.measureText('$0.00').width, (6 + (2 * 12)) * 4/3)
          .fillText('on Gittip.', 9 * 4/3, (6 + (3 * 12)) * 4/3)

        var img = new Image('https://www.gittip.com/assets/widgets/heart.gif');
        document.body.appendChild(img);
        img.onerror = function () {
          console.log('hi');
          ctx.drawImage(img, 50, 50);
        };
        img.onload = function () {
          console.log('hi');
          ctx.drawImage(img, 50, 50);
        };
      </script>
    </div>
  </body>
</html>
